define("fishstrap/ui/table.js",function(e,t,a){var n=e("fishstrap/core/global.js"),i=e("fishstrap/ui/dialog.js");a.exports={staticSimpleTable:function(e){function t(){n("#"+p.id).find("tbody").empty()}function a(e,t){e.find("td").each(function(){for(var e=null,a=0;a!=p.column.length;++a)if(p.column[a].id==n(this).attr("class")){e=p.column[a];break}null!=e&&1!=_.isUndefined(t[e.id])&&("hidden"==e.type?n(this).text(t[e.id]):"image"==e.type?n(this).find("img").attr("src",t[e.id]):"textInput"==e.type?n(this).find("input").val(t[e.id]):n(this).text(t[e.id]))})}function i(e){var t={};return e.find("td").each(function(){for(var e=null,a=0;a!=p.column.length;++a)if(p.column[a].id==n(this).attr("class")){e=p.column[a];break}null!=e&&(t[e.id]="hidden"==e.type?n(this).text():"image"==e.type?n(this).find("img").attr("src"):"textInput"==e.type?n(this).find("input").val():n(this).text())}),t}function r(){var e=[];return n("#"+p.id).find("tbody tr").each(function(){for(var t=n(this);0==t.is("tr");)t=t.parent();e.push(i(t))}),e}function o(){for(var e=function(e,t){for(;0==e.is("tr");)e=e.parent();var n=i(e),r={remove:function(){e.remove()},mod:function(t){a(e,t)},moveUp:function(){var t=e.prev();e.insertBefore(t)},moveDown:function(){var t=e.next();t.insertBefore(e)}};t(n,r)},t=0;t!=p.operate.length;++t)!function(t){n("#"+p.id).find(".operate_"+p.operate[t].id).unbind("click").click(function(){e(n(this),p.operate[t].click)})}(t);for(var t=0;t!=p.column.length;++t)!function(t){var a=p.column[t];"textInput"==a.type&&0==_.isUndefined(a.change)&&n("#"+p.id).find("."+a.id+" input").unbind("input").on("input",function(){e(n(this),a.change)})}(t)}function l(e){for(var t="",a=0;a!=p.operate.length;++a)p.operate[a].id=n.uniqueNum(),t+="<a href='javascript: void(0)' class=operate_"+p.operate[a].id+">"+p.operate[a].name+"</a>&nbsp;";for(var i="",a=0;a!=e.length;++a){var r=e[a];if(0==p.operate.length)var o="width:"+1/p.column.length*100+"%;";else var o="width:"+1/(p.column.length+1)*100+"%;";i+="<tr>";for(var l=0;l!=p.column.length;++l){var d=p.column[l];i+="hidden"==d.type?'<td style="display:none;'+o+'" class="'+d.id+'">'+r[d.id]+"</td>":"image"==d.type?'<td style="'+o+'" class="'+d.id+'"><img src="'+r[d.id]+'"/></td>':"textInput"==d.type?'<td style="'+o+'" class="'+d.id+'"><input style="width:100%" type="text" value="'+r[d.id]+'"/></td>':'<td style="'+o+'" class="'+d.id+'">'+r[d.id]+"</td>"}0!=p.operate.length&&(i+='<td style="'+o+'" >'+t+"</td>"),i+="</tr>"}return i}function d(e){var t="";if(t+='<div class="mod-basic">',t+='<table class="mod_table" style="table-layout: auto;">',t+="<thead><tr>",0==p.operate.length)var a="width:"+1/p.column.length*100+"%;";else var a="width:"+1/(p.column.length+1)*100+"%;";for(var i=0;i!=p.column.length;++i){var r=p.column[i];t+="hidden"==r.type?'<th style="display:none;'+a+'"><span class="label">'+r.name+"</span></th>":'<th style="'+a+'"><span class="label">'+r.name+"</span></th>"}0!=p.operate.length&&(t+='<th><span class="label" style="'+a+'">操作</span></th>'),t+="</tr></thead>",t+="<tbody>",t+=l(e),t+="</tbody>",t+="</table>",t+="</div>",t=n(t),n("#"+p.id).empty(),n("#"+p.id).append(t),o()}function s(e){n("#"+p.id).find("tbody").append(l(e)),o()}function c(e){n("#"+p.id).find("tbody").prepend(l(e)),o()}var p={id:"",data:"",column:[],operate:[]};for(var u in e)p[u]=e[u];return d(p.data),{preadd:c,add:s,get:r,clear:t}},staticTable:function(e){function t(e){var t={};return e.find("td").each(function(){for(var e=n(this).attr("class"),a=null,i=0;i!=o.column.length;++i){var r=o.column[i];if(r.id==e){a=r;break}}if(null!=a){var l;l="image"==a.type?n(this).find("img").attr("src"):n(this).text(),t[e]=l}}),t}function a(e,t,a){var i=n.url.toInfo(a),r={};for(var o in s.fields)r[o]=s.fields[o].thText;var l="";l+='<form action="'+i.originpathname+'" method="get" style="display:none">';for(o in i.search){var d=o,c=i.search[o];l+='<input type="text" name="'+d+'" class="input-small" value="'+encodeURIComponent(c)+'"/>'}l+='<input type="text" name="_viewTitle" class="input-small" value="'+encodeURIComponent(t)+'"/>',l+='<input type="text" name="_view" class="input-small" value="'+encodeURIComponent(e)+'"/>',l+='<input type="text" name="_viewFormat" class="input-small" value="'+encodeURIComponent(JSON.stringify(r))+'"/>',l+="</form>",l=n(l),n("body").append(l),l.submit()}function r(e,t,a,r){var o={};for(var l in s.fields)o[l]=s.fields[l].thText;n.get("/export/"+e,{source:d,pageIndex:a,pageSize:r,viewTitle:t,viewFormat:JSON.stringify(o)},function(e){return e=n.JSON.parse(e),0!=e.code?void i.message(e.msg):void i.message("导出数据成功，请稍候留意邮箱！")})}var o={id:"",params:{},column:[],operate:[],checkAll:!1,url:null,pageIndex:0,pageSize:10,nextPage:void 0};for(var l in e)o[l]=e[l];var d="",s={};s.table_id=o.id,s.key_index="_id",s.order_field="_id",s.order_type="asc",s.page_size=o.pageSize,s.index=Math.floor(o.pageIndex/o.pageSize),s.container_class="mod-basic box-table",s.table_class="mod_table",s.fields="",s.summary="",s.ifRealPage=!0,s.data="data",s.checkAll=o.checkAll,s.params={};var c="";for(var l in o.params)""!=n.trim(o.params[l])&&"pageIndex"!=l&&"pageSize"!=l&&(c+=l+"="+encodeURIComponent(n.trim(o.params[l]))+"&");c+="t="+(new Date).getTime(),d=-1==o.url.indexOf("?")?o.url+"?"+c:o.url+"&"+c,s.fields={};for(var l=0;l!=o.column.length;++l){var p=o.column[l];if(!p.hidden){var u;!function(e){"text"==e.type?u={thText:e.name}:"enum"==e.type?u={thText:e.name,format:function(t){return e.map[t]}}:"check"==e.type?u={thText:e.name,format:function(t){for(var a=[],n=0;n!=t.length;++n)a.push(e.map[t[n]]);return a.join(",")}}:"image"==e.type&&(u={thText:e.name,format:function(e){return'<img src="'+e+'" style="width:100%;max-width:128px;">'}})}(p),s.fields[p.id]=u}}for(var f="",l=0;l!=o.operate.length;++l)o.operate[l].id=n.uniqueNum(),f+="<a href='#' class=operate_"+o.operate[l].id+">"+o.operate[l].name+"</a>&nbsp;";return 0!=o.operate.length&&(s.fields._oper={thText:"操作",format:function(){return f}}),n.get(d+"&pageIndex="+o.pageIndex+"&pageSize="+o.pageSize,{},function(e){if(e=n.JSON.parse(e),0!=e.code)return void i.message(e.msg);var t=n("<div/>"),a=e.data[s.data];for(var r in a){var l=a[r];for(var c in l){var p=l[c];"string"==typeof p&&(l[c]=t.text(p).html())}}dt=GRI.initDataTable({resultObj:e,name:s.data,tableId:s.table_id,data:e.data[s.data],summary:s.summary,allFields:s.fields,layout:"auto",checkAll:s.checkAll,enableThClick:!0,stopToday:!1,keyIndex:s.key_index,page:{orderField:s.order_field,orderType:s.order_type,ifRealPage:s.ifRealPage,size:s.page_size,rowCount:e.data.count,index:s.index,url:d},cssSetting:{containerClass:s.container_class,tableClass:s.table_class},callbackJson:o.nextPage,callback:function(){for(var e=0;e!=o.operate.length;++e)!function(e){n(".operate_"+o.operate[e].id).unbind("click").click(function(){for(var t=n(this);0==t.is("tr");)t=t.parent();var a={};t.find("td").each(function(){a[n(this).attr("class")]=n(this).text()}),o.operate[e].click(a)})}(e)}})}),{getCheckData:function(){var e=n("#"+o.id+" .gri_td_checkbox:checked"),a=[];return e.each(function(){var e=n(this).parent().parent();a.push(t(e))}),a},exportDataToTxt:function(e){i.input("请输入需要导出txt的页数（不填代表导出本页数据）",function(t){""==t&&(t=1),t=o.pageSize*t;var n=d+"&pageIndex="+o.pageIndex+"&pageSize="+t;a("txt",e,n)})},exportDataToExcel:function(e){i.input("请输入需要导出excel的页数（不填代表导出本页数据）",function(t){""==t&&(t=1),t=o.pageSize*t;var n=d+"&pageIndex="+o.pageIndex+"&pageSize="+t;a("excel",e,n)})},exportDataToExcelAsync:function(e){i.input("请输入需要导出excel的页数（不填代表导出本页数据）",function(t){""==t&&(t=1),t=o.pageSize*t,r("excel",e,o.pageIndex,t)})}}}}});