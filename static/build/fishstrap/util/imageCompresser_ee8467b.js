define("fishstrap/util/imageCompresser.js",function(t,e,a){var r=t("fishstrap/core/global.js"),n=t("fishstrap/util/jpegEncoder.js");a.exports={isIosSubSample:function(t){var e=t.naturalWidth,a=t.naturalHeight,r=!1;if(e*a>1048576){var n=document.createElement("canvas");ctx=n.getContext("2d"),n.width=n.height=1,ctx.drawImage(t,1-e,0),r=0===ctx.getImageData(0,0,1,1).data[3],n=ctx=null}return r},getIosImageRatio:function(t,e,a){var r,n=document.createElement("canvas"),o=n.getContext("2d"),i=0,c=a,s=a;for(n.width=1,n.height=a,o.drawImage(t,1-Math.ceil(Math.random()*e),0),r=o.getImageData(0,0,1,a).data;s>i;){var l=r[4*(s-1)+3];0===l?c=s:i=s,s=c+i>>1}return s/a},drawImageIosFix:function(t,e,a,r,n,o,i,c,s,l){this.isIosSubSample(e)&&(n/=2,o/=2);var d,g,h,u,m,w,I,f,x=document.createElement("canvas"),v=x.getContext("2d"),p=1024,b=this.getIosImageRatio(e,n,o);for(x.width=x.height=p,g=0;o>g;){for(u=g+p>o?o-g:p,d=0;n>d;)h=d+p>n?n-d:p,v.clearRect(0,0,p,p),v.drawImage(e,-d-a,-g-r),m=Math.floor(d*s/n),I=Math.ceil(h*s/n),w=Math.floor(g*l/o/b),f=Math.ceil(u*l/o/b),t.drawImage(x,0,0,h,u,m,w,I,f),d+=p;g+=p}},clipImage:function(t,e,a,r,n){var o=document.createElement("canvas"),i=o.getContext("2d");o.width=r,o.height=n;var c=t.getImageData(e,a,r,n);return i.putImageData(c,0,0),{canvas:o,context:i}},getImageBase64:function(t,e){e=r.extend({maxW:2e3,maxH:2e3,quality:.8,scale:0,orien:1},e);var a,o,i,c=e.maxW,s=e.maxH,l=e.quality,d=t.naturalWidth,g=t.naturalHeight,h=0,u=0,m=e.scale;i=e.orien>=5&&e.orien<=8?!0:!1,m&&0!=m?0==i?d/g>=m?(o=s,a=o*m,h=(d-m*g)/2,u=0,d=m*g,g=g):(a=c,o=a/m,h=0,u=(g-d/m)/2,d=d,g=d/m):g/d>=m?(a=s,o=s*m,h=0,u=(g-d*m)/2,d=d,g=d*m):(o=c,a=c/m,u=0,h=(d-g/m)/2,g=g,d=g/m):d>c&&d/g>=c/s?(a=c,o=g*c/d):g>s&&g/d>=s/c?(a=d*s/g,o=s):(a=d,o=g);var w,I=document.createElement("canvas"),f=I.getContext("2d");if(this.doAutoRotate(I,a,o,e.orien),r.os.ios?this.drawImageIosFix(f,t,h,u,d,g,0,0,a,o):f.drawImage(t,h,u,d,g,0,0,a,o),r.os.android){var v=f.getImageData(0,0,I.width,I.height);x=n.JPEGEncoder(100*l),w=n.encode(v),x=null}else w=I.toDataURL("image/jpeg",l);return I=f=null,w},doAutoRotate:function(t,e,a,r){var n=t.getContext("2d");switch(r>=5&&8>=r?(t.width=a,t.height=e):(t.width=e,t.height=a),r){case 2:n.translate(e,0),n.scale(-1,1);break;case 3:n.translate(e,a),n.rotate(Math.PI);break;case 4:n.translate(0,a),n.scale(1,-1);break;case 5:n.rotate(.5*Math.PI),n.scale(1,-1);break;case 6:n.rotate(.5*Math.PI),n.translate(0,-a);break;case 7:n.rotate(.5*Math.PI),n.translate(e,-a),n.scale(-1,1);break;case 8:n.rotate(-.5*Math.PI),n.translate(-e,0)}},getFileObjectURL:function(t){var e=window.URL||window.webkitURL||!1;return e?e.createObjectURL(t):void 0},support:function(){return typeof window.File&&typeof window.FileList&&typeof window.FileReader&&typeof window.Blob}}});