define("fishstrap/util/jpegMeta.js",function(e,t,i){i.exports={init:function(){var e={};this.JpegMeta=e,e.parseNum=function(e,t,i,a){var r,n,o=">"===e;for(void 0===i&&(i=0),void 0===a&&(a=t.length-i),r=o?i:i+a-1;o?i+a>r:r>=i;o?r++:r--)n<<=8,n+=t.charCodeAt(r);return n},e.parseSnum=function(e,t,i,a){var r,n,o,s=">"===e;for(void 0===i&&(i=0),void 0===a&&(a=t.length-i),r=s?i:i+a-1;s?i+a>r:r>=i;s?r++:r--)void 0===o&&(o=128===(128&t.charCodeAt(r))),n<<=8,n+=o?255&~t.charCodeAt(r):t.charCodeAt(r);return o&&(n+=1,n*=-1),n},e.Rational=function(e,t){return this.num=e,this.den=t||1,this},e.Rational.prototype.toString=function(){return 0===this.num?""+this.num:1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},e.Rational.prototype.asFloat=function(){return this.num/this.den},e.MetaGroup=function(e,t){return this.fieldName=e,this.description=t,this.metaProps={},this},e.MetaGroup.prototype._addProperty=function(t,i,a){var r=new e.MetaProp(t,i,a);this[r.fieldName]=r,this.metaProps[r.fieldName]=r},e.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},e.MetaProp=function(e,t,i){return this.fieldName=e,this.description=t,this.value=i,this},e.MetaProp.prototype.toString=function(){return""+this.value},e.JpegFile=function(t,i){var a=this._SOS;this.metaGroups={},this._binary_data=t,this.filename=i;var r,n,o,s,l,u,p,d=0,f=0;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(d+=2;d<this._binary_data.length&&(r=this._binary_data.charCodeAt(d++),n=this._binary_data.charCodeAt(d++),f=d,r==this._DELIM)&&n!==a;){for(l=e.parseNum(">",this._binary_data,d,2),d+=l;d<this._binary_data.length;)if(console.log(d+","+this._binary_data.length),r=this._binary_data.charCodeAt(d++),r==this._DELIM&&(o=this._binary_data.charCodeAt(d++),0!=o)){d-=2;break}s=d-f,this._markers[n]?(u=this._markers[n][0],p=this._markers[n][1]):(u="UNKN",p=void 0),p&&this[p](n,f+2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},this.JpegMeta.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},this.JpegMeta.JpegFile.prototype._SOI_MARKER="ÿØ",this.JpegMeta.JpegFile.prototype._DELIM=255,this.JpegMeta.JpegFile.prototype._EOI=217,this.JpegMeta.JpegFile.prototype._SOS=218,this.JpegMeta.JpegFile.prototype._sofHandler=function(t,i){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",e.parseNum(">",this._binary_data,i,1)),this.general._addProperty("pixelHeight","Pixel Height",e.parseNum(">",this._binary_data,i+1,2)),this.general._addProperty("pixelWidth","Pixel Width",e.parseNum(">",this._binary_data,i+3,2)),this.general._addProperty("type","Type",this._markers[t][2])},this.JpegMeta.JpegFile.prototype._JFIF_IDENT="JFIF\x00",this.JpegMeta.JpegFile.prototype._JFXX_IDENT="JFXX\x00",this.JpegMeta.JpegFile.prototype._EXIF_IDENT="Exif\x00",this.JpegMeta.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},this.JpegMeta.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},this.JpegMeta.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},this.JpegMeta.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},this.JpegMeta.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count “0”"],209:["RST1",null,"Restart with modulo 8 count “1”"],210:["RST2",null,"Restart with modulo 8 count “2”"],211:["RST3",null,"Restart with modulo 8 count “3”"],212:["RST4",null,"Restart with modulo 8 count “4”"],213:["RST5",null,"Restart with modulo 8 count “5”"],214:["RST6",null,"Restart with modulo 8 count “6”"],215:["RST7",null,"Restart with modulo 8 count “7”"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]},this.JpegMeta.JpegFile.prototype._addMetaGroup=function(t,i){var a=new e.MetaGroup(t,i);return this[a.fieldName]=a,this.metaGroups[a.fieldName]=a,a},this.JpegMeta.JpegFile.prototype._parseIfd=function(t,i,a,r,n,o,s){var l,u,p,d,h,m,c,g,P,S,_,y,D,F=e.parseNum(t,i,a+r,2);D=this._addMetaGroup(o,s);for(var l=0;F>l;l++)if(p=a+r+2+12*l,d=e.parseNum(t,i,p,2),m=e.parseNum(t,i,p+2,2),g=e.parseNum(t,i,p+4,4),P=e.parseNum(t,i,p+8,4),void 0!==this._types[m]){if(h=this._types[m][0],c=this._types[m][1],P=4>=c*g?p+8:a+P,"UNDEFINED"==h)f=i.slice(P,P+g);else if("ASCII"==h)S=i.slice(P,P+g),S=S.split("\x00")[0];else{for(S=new Array,u=0;g>u;u++,P+=c)("BYTE"==h||"SHORT"==h||"LONG"==h)&&S.push(e.parseNum(t,i,P,c)),("SBYTE"==h||"SSHORT"==h||"SLONG"==h)&&S.push(e.parseSnum(t,i,P,c)),"RATIONAL"==h&&(_=e.parseNum(t,i,P,4),y=e.parseNum(t,i,P+4,4),S.push(new e.Rational(_,y))),"SRATIONAL"==h&&(_=e.parseSnum(t,i,P,4),y=e.parseSnum(t,i,P+4,4),S.push(new e.Rational(_,y))),S.push();1===g&&(S=S[0])}void 0!==n[d]&&D._addProperty(n[d][1],n[d][0],S)}},this.JpegMeta.JpegFile.prototype._jfifHandler=function(t,i){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(i+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(i+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(i+7)),this.jfif._addProperty("Xdensity","X density",e.parseNum(">",this._binary_data,i+8,2)),this.jfif._addProperty("Ydensity","Y Density",e.parseNum(">",this._binary_data,i+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",e.parseNum(">",this._binary_data,i+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",e.parseNum(">",this._binary_data,i+13,1))},this.JpegMeta.JpegFile.prototype._app0Handler=function(e,t){var i=this._binary_data.slice(t,t+5);i==this._JFIF_IDENT?this._jfifHandler(e,t):i==this._JFXX_IDENT},this.JpegMeta.JpegFile.prototype._app1Handler=function(e,t){var i=this._binary_data.slice(t,t+5);i==this._EXIF_IDENT&&this._exifHandler(e,t+6)},e.JpegFile.prototype._exifHandler=function(t,i){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var a,r,n,o=this._binary_data.slice(i,i+2);if("II"===o)a="<";else{if("MM"!==o)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+o);a=">"}if(r=e.parseNum(a,this._binary_data,i+2,2),42!==r)throw new Error("Malformed TIFF meta-data. Bad magic: "+r);n=e.parseNum(a,this._binary_data,i+4,4),this._parseIfd(a,this._binary_data,i,n,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(a,this._binary_data,i,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer}}},i.exports.init()});